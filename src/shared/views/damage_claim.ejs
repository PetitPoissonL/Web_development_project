<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <title>Damage Claim - SNWLC ASSURANCE</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">

  <!-- Custom styles for this template -->
  <link href="../css/quote.css" rel="stylesheet">
</head>

<body>

  <!-- Navigation-->
  <div>
    <%- include('./navbar'); %>
  </div>

  <!-- Do not delete this block -->
  <!-- Content section-->
  <div class="container-fluid py-5">
    <main>
     <div id="alert_damageReport" style="display: hidden; text-align: center;"></div>

      <div class="py-5 text-center">
        <h2>Claim Damages of your car</h2>
      </div>

      <div class="row justify-content-md-cente">
        <!-- <form action=/quote method="post"> -->
        <form action=/dashboard/damage-claim-send method="post" class="needs-validation" novalidate>
          <div class="row g-3">
            <h4 class="mb-3">Verify your personal information</h4>
            <hr class="my-4">

            <!-- Email -->
            <div class="col-12" label="nom_prÃ©nom">
              <div class="row">
                <div class="col-sm-6">
                  <label for="email" class="form-label">Your Email :</label>
                </div>
                <div class="col-sm-6">
                  <span class="input-group-text form-control"><%= userEmail %></span>
                </div>
              </div>
            </div>

            <div class="col-12" label="firstname">
              <div class="row">
                <div class="col-sm-6">
                  <label class="form-label">Your First Name </label>
                </div>
                <div class="col-sm-6">
                  <span class="input-group-text form-control"><%= firstName %></span>
                </div>
              </div>
            </div>

            <div class="col-12" label="lastname">
              <div class="row">
                <div class="col-sm-6">
                  <label class="form-label">Your Last Name </label>
                </div>
                <div class="col-sm-6">
                  <span class="input-group-text sform-control"><%= lastName %></span>
                </div>
              </div>
            </div>


            <div class="col-12" label="lastname">
              <div class="row">
                <div class="col-sm-6">
                  <label class="form-label">Your Permission Id </label>
                </div>
                <div class="col-sm-6">
                  <span class="input-group-text sform-control"><%= userPermiId %></span>
                </div>
              </div>
            </div>


            <hr class="my-4">
            <h4 class="mb-3">Tell us what happened </h4>
            <hr class="my-4">

            <div class="col-12" label="contract_id">
              <div class="row">
                <div class="col-sm-6">
                  <label for="contract_id" class="form-label">Contract Id :</label>
                </div>
                <div class="col-sm-6">
                  <input type="text" name="contract_id" id="contract_id" class="form-control" required>
                  <div class="invalid-feedback">
                    The date of contract id is not validated.
                  </div>
                </div>
              </div>
            </div>

            <!-- car plate number -->
            <div class="col-12" label="plate_number">
              <div class="row">
                <div class="col-sm-6">
                  <label for="plate_number" class="form-label">Plate number :</label>
                </div>
                <div class="col-sm-6">
                  <input type="text" name="plate_number" id="plate_number" class="form-control" required>
                  <div class="invalid-feedback">
                    The date of plate number is not validated.
                  </div>
                </div>
              </div>
            </div>
          
            <!-- Accident date -->
            <div class="col-12" label="accident_date">
              <div class="row">
                <div class="col-sm-6">
                  <label for="accident_date" class="form-label">Date of Accident :</label>
                </div>
                <div class="col-sm-6">
                  <input type="date" name="accident_date" id="accident_date" class="form-control" required>
                  <div class="invalid-feedback">
                    The date of accident is not validated.
                  </div>
                </div>
              </div>
            </div>

            <div class="col-12" label="location">
              <div class="row">
                <div class="col-sm-6">
                  <label for="location" class="form-label">Location of Accident (city, street):</label>
                </div>
                <div class="col-sm-6">
                  <input type="text" name="location" id="location" class="form-control" required>
                  <div class="invalid-feedback">
                    The location of accident is not validated.
                  </div>
                </div>
              </div>
            </div>

            <!-- Vehicle energy -->
            <div class="col-12" label="description">
              <div class="row">
                <div class="col-sm-6">
                  <label for="energie" class="form-label">Description of Accident : </label>
                </div>
                <div class="col-sm-6">
                  <input type="text" name="description" id="description" class="form-control" required>
              
                  <div class="invalid-feedback">
                    Please choose the vehicle energy.
                  </div>
                </div>
              </div>
            </div>

            <hr class="my-4">
            <h4 class="mb-3">Upload Your Documents</h4>
            <hr class="my-4">

            <!-- upload image -->
            <div class="col-12" label="documentAccident">
              <div class="row">
                <div class="col-sm-6">
                  <label for="descriptionDate" class="form-label">Image of your car : </label>
                </div>
                <div class="col-sm-6">

                  <form method="post" enctype="multipart/form-data">
                    <div>
                      <input type="file" id="image_uploads" name="image_uploads" accept=".jpg, .jpeg, .png"   style="position:absolute;height:320px;width:550px;">
                    </div>
                    <div class="preview" style="float:left;background:white; 
                        border: 1px solid; border-color: gainsboro; border-radius: 5%;
                        height:320px;width:450px;text-align:center;z-index:1;">
                      <p style="line-height: 300px;">Click to upload your mage</p></div>

                  </form>
                </div>
              </div>
            </div>

            <hr class="my-4">
            <button type="submit" class="w-100 btn btn-primary"> Save and Send </button>
        
        </form>

      </div>
    </main>
  </div>

  <!-- Footer-->
  <footer class="text-muted bg-secondary py-3">
    <%- include('./footer'); %>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
    crossorigin="anonymous">
  </script>
  <script type="text/javascript">
    //display image uploaded
    var input = document.getElementById('image_uploads');
    var preview = document.querySelector('.preview');

    input.style.opacity = 0;
    input.addEventListener('change', updateImageDisplay);function updateImageDisplay() {
      while(preview.firstChild) {
        preview.removeChild(preview.firstChild);
      }

      if(input.files.length === 0) {
        var para = document.createElement('p');
        para.textContent = 'No Image chosen';
        para.style="line-height: 100px;";
        preview.appendChild(para);
      } 
      else {
        var para = document.createElement('p');
        var image = document.createElement('img');
        image.src = window.URL.createObjectURL(input.files[0]);

        preview.appendChild(image);
        preview.appendChild(para);
      }
    }

    const alert_damageReport = document.getElementById('alert_damageReport');
    const params       = (new URL(document.location)).searchParams;
        // Get item in param object
    
    const statusCode   = params.get('status');
    let className    = '';
    let alertMessage = '';
    console.log('params',     params);
    console.log('statusCode', statusCode);
    switch (statusCode)
    {
            case 'DAMAGE_REPORT_SAVE' :
                className = 'success';
                alertMessage = 'Your report has been registered';
                alert_damageReport.style.display="block";
                break;
            case 'DAMAGE_REPORT_FAIL' :
                className = 'danger';
                alertMessage = 'We did not find the car related,  please contact us!';
                alert_damageReport.style.display="block";
                break;

            case 'PLATE_NUMBER_NO_MATCH':
                className = 'danger';
                alertMessage = 'Your plate number is not match, please verify it again!';
                alert_damageReport.style.display="block";
                break;

            case 'CONTTRACT_NO_EXIST':
                className = 'danger';
                alertMessage = 'We did not find any contract with this id, please verify it again!';
                alert_damageReport.style.display="block";
                break;
    }
    alert_damageReport.innerHTML = alertMessage;
    alert_damageReport.className = 'alert alert-' + className;

    //decrypto token and get contents
    function parseJwt (token) {
      var base64Url = token.split('.')[1];
      var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
      var jsonPayload = decodeURIComponent(window.atob(base64).split('').map(function(c) {
          return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
      }).join(''));

      return JSON.parse(jsonPayload);
    }

    //disable email input if user already login
    if (cookieValue){
        console.log(cookieValue)
        const res = parseJwt(cookieValue)
        const email_element = document.getElementById('email');
        email_element.setAttribute('value', res.email.toString())
        email_element.setAttribute('readonly','readonly');
    }

  </script>
</body>
</html>
